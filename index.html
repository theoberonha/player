<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>O Ser Humano e suas ferramentas?</title>
  <style>
    /* Container geral */
    body {
      margin: 0;
      padding: 20px;
      font-family: sans-serif;
      background: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .player-wrapper {
      background: #bcdd49;
      border-radius: 8px;
      width: 100%;
      max-width: 800px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    /* Header com t√≠tulo */
    .player-header {
      background: #9ecf3e;
      padding: 12px;
      text-align: center;
    }
    .player-header h1 {
      margin: 0;
      font-size: 20px;
      color: #fff;
    }
    /* √Årea de v√≠deo */
    .video-container {
      position: relative;
      background: #000;
    }
    video#video {
      width: 100%;
      display: block;
    }
    /* Overlay de legenda */
    #legendOverlay {
      position: absolute;
      bottom: 50px;
      width: 100%;
      text-align: center;
      color: #fff;
      font-size: 16px;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
      pointer-events: none;
    }
    /* Barra de progresso customizada */
    .progress-bar {
      position: relative;
      height: 8px;
      background: #333;
    }
    .progress {
      height: 100%;
      background: #9ecf3e;
      width: 0;
    }
    .progress-handle {
      position: absolute;
      top: -4px;
      left: 0;
      width: 16px;
      height: 16px;
      background: #bcdd49;
      border: 2px solid #fff;
      border-radius: 50%;
      transform: translateX(-50%);
      cursor: pointer;
    }
    /* Controles inferiores */
    .controls { 
      display: flex;
      align-items: center;
      padding: 10px;
      background: #fff;
      gap: 8px;
    }
    .controls button {
      background: #eee;
      border: none;
      padding: 8px;
      font-size: 16px;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .controls button.active {
      background: #9ecf3e;
      color: #fff;
    }
    .controls button svg {
      width: 20px;
      height: 20px;
    }
    /* Caixa de transcri√ß√£o */
    #transcript {
      display: none;
      background: #fff;
      max-height: 200px;
      overflow-y: auto;
      padding: 10px;
      border-top: 1px solid #ccc;
    }
    #transcript p {
      margin: 4px 0;
      cursor: pointer;
    }
    #transcript p.highlight {
      background: yellow;
    }
    /* Libras flutuante */
    video#librasVideo {
      position: fixed;
      width: 200px;
      top: 20px;
      right: 20px;
      border: 2px solid #fff;
      display: none;
      cursor: move;
      z-index: 1000;
      background: #000;
    }
  </style>
</head>
<body>
  <div class="player-wrapper">
    <div class="player-header">
      <h1>O Ser Humano e suas ferramentas?</h1>
    </div>
    <div class="video-container" id="container">
      <video id="video" preload="metadata" playsinline webkit-playsinline controlsList="nofullscreen nodownload">
        <source src="Capitulo_01_O_ser_humano_e_suas_ferramentas_LIBRAS_correcao.mp4" type="video/mp4">
      </video>
      <div id="legendOverlay"></div>
      <div class="progress-bar" id="progressBar">
        <div class="progress" id="progress"></div>
        <div class="progress-handle" id="handle"></div>
      </div>
    </div>
    <div class="controls">
      <button id="btnPlay">&#9658;</button>
      <button id="toggleDesc">A</button>
      <button id="toggleSubs">L</button>
      <button id="toggleTrans">T</button>
     <!--<button id="toggleLibras">üì∫</button>-->
      <button id="toggleFs">‚õ∂</button>
    </div>
    <div id="transcript"></div>
  </div>
  <video id="librasVideo" muted loop preload="auto" playsinline webkit-playsinline>
    <source src="libras.mp4" type="video/mp4">
  </video>
  <script>
    const subs = [ /* ... seus subt√≠tulos ... */ ];
    const descs = [ /* ... suas descri√ß√µes ... */ ];

    document.addEventListener('DOMContentLoaded', () => {
      const video = document.getElementById('video'), playBtn = document.getElementById('btnPlay');
      const btnDesc = document.getElementById('toggleDesc'), btnSubs = document.getElementById('toggleSubs');
      const btnTrans = document.getElementById('toggleTrans'), btnLibras = document.getElementById('toggleLibras');
      const btnFs = document.getElementById('toggleFs'), overlay = document.getElementById('legendOverlay');
      const transcript = document.getElementById('transcript'), libras = document.getElementById('librasVideo');
      const progressBar = document.getElementById('progressBar'), progress = document.getElementById('progress');
      const handle = document.getElementById('handle');

      let showSubs = false, showDesc = false, showTrans = false, showLibras = false, lastDesc = -1, dragging = false;
      let offsetX = 0, offsetY = 0;

      // Pr√©-carrega vozes (opcional, para garantir getVoices funcione corretamente)
      speechSynthesis.onvoiceschanged = () => {};

      playBtn.addEventListener('click', () => video.paused ? video.play() : video.pause());
      video.addEventListener('play', () => playBtn.textContent = '‚ùö‚ùö');
      video.addEventListener('pause', () => playBtn.textContent = '‚ñ∫');

      function updateProgress() {
        const pct = (video.currentTime / video.duration) * 100;
        progress.style.width = pct + '%';
        handle.style.left = pct + '%';
      }

      video.addEventListener('timeupdate', () => {
        updateProgress();
        const t = video.currentTime;
        if (showSubs) updateLegend(t);
        if (showDesc) updateDesc(t);
        if (showTrans) updateTranscript(t);
        if (showLibras) libras.currentTime = t;
      });

      handle.addEventListener('mousedown', () => dragging = true);
      document.addEventListener('mousemove', e => {
        if (!dragging) return;
        const rect = progressBar.getBoundingClientRect();
        let pct = (e.clientX - rect.left) / rect.width;
        pct = Math.max(0, Math.min(1, pct));
        video.currentTime = pct * video.duration;
      });
      document.addEventListener('mouseup', () => dragging = false);

      btnSubs.addEventListener('click', () => {
        showSubs = !showSubs;
        btnSubs.classList.toggle('active', showSubs);
        btnSubs.textContent = showSubs ? 'L ' : 'L';
        if (!showSubs) overlay.textContent = '';
      });

      function updateLegend(t) {
        const cue = subs.find(c => t >= c.start && t <= c.end);
        overlay.textContent = (showSubs && cue) ? cue.text : '';
      }

      btnDesc.addEventListener('click', () => {
        showDesc = !showDesc;
        btnDesc.classList.toggle('active', showDesc);
        btnDesc.textContent = showDesc ? 'A ' : 'A';
        lastDesc = -1;
        speechSynthesis.cancel();
      });

      function updateDesc(t) {
        const idx = descs.findIndex(c => t >= c.start && t <= c.end);
        if (idx !== -1 && idx !== lastDesc) {
          lastDesc = idx;
          video.pause();
          const utt = new SpeechSynthesisUtterance(descs[idx].text);
          // Define o idioma para portugu√™s
          utt.lang = 'pt-BR';
          // Opcional: seleciona a primeira voz dispon√≠vel em pt
          const ptVoices = speechSynthesis.getVoices().filter(v => v.lang.startsWith('pt'));
          if (ptVoices.length) utt.voice = ptVoices[0];
          utt.onend = () => video.play();
          speechSynthesis.speak(utt);
        }
      }

      btnTrans.addEventListener('click', () => {
        showTrans = !showTrans;
        btnTrans.classList.toggle('active', showTrans);
        btnTrans.textContent = showTrans ? 'T ' : 'T';
        transcript.style.display = showTrans ? 'block' : 'none';
        if (showTrans) {
          transcript.innerHTML = subs.map((c, i) => `<p data-index="${i}">${c.text}</p>`).join('');
          attachTranscriptClicks();
        }
      });

      function updateTranscript(t) {
        subs.forEach((c, i) => {
          const p = transcript.querySelector(`p[data-index='${i}']`);
          if (t >= c.start && t <= c.end) {
            p.classList.add('highlight');
            p.scrollIntoView({behavior: 'smooth', block: 'nearest'});
          } else p.classList.remove('highlight');
        });
      }

      function attachTranscriptClicks() {
        transcript.querySelectorAll('p').forEach(p => {
          p.addEventListener('click', () => {
            const i = parseInt(p.dataset.index, 10);
            video.currentTime = subs[i].start;
            video.play();
          });
        });
      }

      btnLibras.addEventListener('click', () => {
        showLibras = !showLibras;
        btnLibras.classList.toggle('active', showLibras);
        btnLibras.textContent = showLibras ? 'üì∫ On' : 'üì∫';
        if (showLibras) {
          libras.style.display = 'block';
          libras.currentTime = video.currentTime;
          libras.play();
          video.addEventListener('play', () => libras.play());
          video.addEventListener('pause', () => libras.pause());
        } else {
          libras.pause();
          libras.style.display = 'none';
        }
      });

      libras.addEventListener('mousedown', e => {
        dragging = true;
        offsetX = e.clientX - libras.getBoundingClientRect().left;
        offsetY = e.clientY - libras.getBoundingClientRect().top;
        document.body.style.userSelect = 'none';
      });
      document.addEventListener('mousemove', e => {
        if (!dragging) return;
        libras.style.left = (e.clientX - offsetX) + 'px';
        libras.style.top = (e.clientY - offsetY) + 'px';
      });
      document.addEventListener('mouseup', () => {
        dragging = false;
        document.body.style.userSelect = '';
      });

      btnFs.addEventListener('click', () => {
        const el = document.getElementById('container');
        document.fullscreenElement ? document.exitFullscreen() : el.requestFullscreen();
      });
    });
  </script>
</body>
</html>
